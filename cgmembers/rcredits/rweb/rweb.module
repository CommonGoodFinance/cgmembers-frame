<?php
/**
 * @file
 * rCredits Web Interface
 *
 * An interface module for the rCredits financial system.
 *
 * Note: to display one of the blocks defined herein on a page, use
 * echo render(module_invoke('rweb', 'block_view', 'blockname')); 
 * (or simpler: echo render(rweb_block_view('blockname'));)
 */

use rCredits as r;
require_once __DIR__ . '/../rcredits.inc';
require_once __DIR__ . '/rweb.inc';

define('RWEB_FORMS', 'account payment buy_now example_store charge exchange manage tx_period txs manage_account');

function rweb_block_info() {
  $info = array();
  foreach (r\ray(RWEB_FORMS) as $one) $info[$one] = r\Web\block_def(lcfirst($one) . ' Block');
  return $info;
}

function rweb_block_view($delta = '') {
  if (!in_array($delta, r\ray(RWEB_FORMS))) return;
  return r\Web\block_view(NULL, drupal_get_form("rCredits\\Web\\{$delta}_form")); // no subject for blocks
}

/**
 * Implements hook_menu().
 */
function rweb_menu() {
  return array(
    'members' => r\Web\menu('Members Section', MENU_NORMAL_ITEM, 'member_section'),
    'members/transact' => r\Web\menu('Transact', MENU_DEFAULT_LOCAL_TASK),
    'members/contact-info' => r\Web\menu('Contact Info', MENU_LOCAL_TASK, 'show_form', array('contact_info')),
    'members/sharing' => r\Web\menu('Sharing', MENU_LOCAL_TASK, 'show_form', array('share')),
    'members/manage-transactions' => r\Web\menu('Manage Transactions', MENU_LOCAL_TASK, 'show_form', array('txs')),
  );
}
